<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalle de Gráfica</title>
    <style>
        body {
            margin: 0; padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            min-height: 100vh;
        }
        .container {
            text-align: center; background: white;
            padding: 40px; border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            max-width: 800px; width: 90%;
        }
        h1 { color: #333; font-size: 24px; margin-bottom: 20px; font-weight: 700; }
        h2 { color: #666; font-size: 16px; margin-bottom: 40px; font-weight: normal; }
        
        .pie-chart {
            width: 280px; height: 280px;
            border-radius: 50%; margin: 0 auto 30px auto;
            background: #eee;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
            transition: all 0.5s ease;
        }
        
        .legend { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-bottom: 40px; font-size: 15px; }
        .legend-item { display: flex; align-items: center; gap: 8px; }
        .color-box { width: 18px; height: 18px; border-radius: 4px; }

        .btn-regresar {
            background-color: #3b3bff; color: white;
            padding: 15px 50px; border-radius: 8px;
            text-decoration: none; font-weight: bold;
            font-size: 16px; display: inline-block;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .btn-regresar:hover { background-color: #2a2abf; }
    </style>
</head>
<body>

    <div class="container">
        <h1 id="titulo-pregunta">Cargando datos...</h1>
        
        <div id="grafica" class="pie-chart"></div>

        <div id="leyenda" class="legend"></div>

        <a href="graficas.html" class="btn-regresar">Regresar a Menú Principal</a>
    </div>

    <script>
    const preguntas = [
        "1. Claridad del Propósito: ¿Queda claro para el usuario desde el primer momento qué ofrece la marca y cómo puede solicitar una comisión o producto personalizado (ropa, imprenta, etc.)?",
        "2. Flujo de la Comisión: ¿Es el proceso para solicitar una comisión (desde la idea hasta la cotización/pago) intuitivo, sencillo y con pasos definidos?",
        "3. Navegación Consistente: ¿La estructura de navegación (menús, botones de retorno, barras laterales) es consistente en todas las secciones (tienda)?",
        "4. Diseño Visual: ¿El estilo visual (colores, tipografía, imágenes) refleja la identidad y el profesionalismo de la marca y es visualmente atractivo?",
        "5. Responsividad: ¿El prototipo se visualiza y funciona correctamente en diferentes tamaños de pantalla (móvil, tableta, escritorio)?",
        "6. Funcionalidad del Chat: ¿Qué tan fácil y eficiente es para el usuario iniciar, mantener y dar seguimiento a una conversación con el equipo de la marca a través del chat integrado?",
        "7. Información de Contacto: ¿Se presenta la información de contacto (teléfono, email, redes) de manera accesible?",
        "8. Gestión de Proyectos (Admin): ¿Permite el modo Admin gestionar, filtrar y dar seguimiento al estado de múltiples comisiones y pedidos de manera clara?",
        "9. Carga y Visualización de Diseños: ¿Cómo maneja el prototipo la carga y vista previa de los diseños/archivos que los clientes proporcionan para su personalización?",
        "10. Búsqueda y Filtro de Productos (Si solo aplica): Si hay un catálogo de productos base, ¿es la función de búsqueda y filtrado robusta y útil?",
        "11. Lenguaje y tono: ¿El lenguaje utilizado en el prototipo (instrucciones, mensajes de error, descripciones) es claro, profesional y coherente con el tono de la marca?",
        "12. Manejo de Errores: ¿Los mensajes de error (ej. formato de archivo incorrecto) son informativos y ofrecen soluciones útiles al usuario?",
        "13. Terminología Específica: ¿Se utiliza la terminología adecuada para los productos y procesos de personalización o se explica de forma sencilla para clientes no expertos?",
        "14. Rendimiento: ¿La velocidad de carga y la respuesta de las interacciones (clics, transiciones) del prototipo son aceptables o se sienten lentas?",
        "15. Integración (Simulada): ¿El chatbot y los mensajes funcionan correctamente?"
    ];
        const respuestasRaw = [
            [10,9,9,10,9,10,9,9,10,9,9,10,10,10,9],
            [8,8,7,8,8,8,7,8,8,8,8,7,8,8,8],
            [9,8,8,10,9,7,9,9,10,9,10,4,6,5,7],
            [9,8,8,9,9,8,8,8,9,9,8,9,8,9,8],
            [7,8,7,7,8,7,7,7,8,8,7,7,7,7,7],
            [10,9,10,9,10,9,10,5,9,10,9,9,10,9,10],
            [8,7,8,7,7,7,8,8,7,7,8,7,7,7,7],
            [9,9,9,9,8,9,9,9,4,9,10,9,9,9,9],
            [8,8,7,8,8,8,7,8,8,7,8,8,7,8,8],
            [10,10,9,10,9,9,10,10,10,10,9,10,10,10,10],
            [9,9,8,9,9,9,9,9,3,9,9,8,9,9,8],
            [8,8,8,8,7,8,8,8,8,8,7,8,8,7,7],
            [7,7,7,7,7,7,6,7,7,7,7,7,7,7,7],
            [9,8,9,9,8,9,9,9,9,9,9,9,8,9,9],
            [10,9,10,9,9,10,10,10,9,10,10,10,10,9,10]
        ];

        function obtenerCategoria(valor) {
            if (valor >= 9) return { texto: 'Excelente', color: '#6B2AEA' };
            if (valor >= 7) return { texto: 'Regular', color: '#400F9F' };
            if (valor >= 5) return { texto: 'Ok', color: '#1F91DC' };
            if (valor >= 3) return { texto: 'Meh', color: '##0C3956' };
            return { texto: 'Malo', color: '#cc1433' };
            return { texto: 'Malo', color: '#cc1433' };

        }

        try {
            const params = new URLSearchParams(window.location.search);
            const qParam = params.get('q');
            let index = 0;
            if (qParam && !isNaN(qParam)) index = parseInt(qParam) - 1;
            if (index < 0 || index >= preguntas.length) index = 0;

            const titulo = preguntas[index];
            const datosPregunta = respuestasRaw.map(persona => persona[index]);

            const conteo = {};
            datosPregunta.forEach(val => {
                const cat = obtenerCategoria(val);
                if (!conteo[cat.texto]) {
                    conteo[cat.texto] = { cantidad: 0, color: cat.color };
                }
                conteo[cat.texto].cantidad++;
            });

            const total = datosPregunta.length;

            let gradienteStr = "conic-gradient(";
            let porcentajeAcumulado = 0;
            let leyendaHTML = "";

            for (const [nombre, datos] of Object.entries(conteo)) {
                const porcentaje = (datos.cantidad / total) * 100;
                gradienteStr += `${datos.color} ${porcentajeAcumulado}% ${porcentajeAcumulado + porcentaje}%, `;
                porcentajeAcumulado += porcentaje;

                leyendaHTML += `
                    <div class="legend-item">
                        <div class="color-box" style="background-color: ${datos.color};"></div>
                        <span>${nombre} (${Math.round(porcentaje)}%)</span>
                    </div>
                `;
            }

            gradienteStr = gradienteStr.slice(0, -2) + ")";

            document.getElementById('titulo-pregunta').innerText = titulo;
            document.getElementById('grafica').style.background = gradienteStr;
            document.getElementById('leyenda').innerHTML = leyendaHTML;

        } catch (error) {
            console.error(error);
            document.getElementById('titulo-pregunta').innerText = "Error al cargar los datos.";
            document.getElementById('grafica').style.display = "none";
        }
    </script>
</body>
</html>
