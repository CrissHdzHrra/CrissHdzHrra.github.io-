import React, { useState, useEffect, useRef } from 'react';
import { 
  ShoppingBag, Star, User, Heart, Search, 
  Menu, X, LogOut, Send, Image as ImageIcon, 
  Package, ChevronRight, ChevronDown, 
  MessageSquare, Grid, Plus, Truck, ShieldCheck,
  Settings, Users, BarChart3, Bell, Briefcase, Check,
  Trash2, Lock, Mail, Palette, Monitor, Layers, FileText,
  Clock, CreditCard, MapPin, RefreshCcw, Paperclip, 
  ExternalLink, MessageCircle
} from 'lucide-react';

// --- CONFIGURACI√ìN ---
const WHATSAPP_NUMBER = "526182384062"; // N√∫mero actualizado
const CONTACT_EMAIL = "Crisspvnk@gmail.com";

// --- ESTILOS GLOBALES ---
const GlobalStyles = () => (
  <style>{`
    @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:wght@300;400;500;600;700&display=swap');

    :root {
      --primary-red: #D32F2F;
      --hover-red: #B71C1C;
      --text-black: #111111;
      --bg-white: #FFFFFF;
      --bg-light: #F4F4F5;
    }

    body {
      background-color: var(--bg-white);
      font-family: 'Montserrat', sans-serif;
      margin: 0;
      color: var(--text-black);
      overflow-x: hidden;
    }

    h1, h2, h3, h4, .font-bebas { font-family: 'Bebas Neue', sans-serif; letter-spacing: 1px; }
    
    .fade-in { animation: fadeIn 0.6s ease-out forwards; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .slide-in-right { animation: slideInRight 0.3s ease-out forwards; }
    @keyframes slideInRight { from { transform: translateX(100%); } to { transform: translateX(0); } }

    .scale-up { animation: scaleUp 0.3s ease-out forwards; }
    @keyframes scaleUp { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

    .slide-up { animation: slideUp 0.4s ease-out forwards; }
    @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

    .input-minimal {
      border: none;
      border-bottom: 1px solid #ddd;
      padding: 12px 0;
      width: 100%;
      outline: none;
      transition: border-color 0.3s;
      font-family: 'Montserrat', sans-serif;
      background: transparent;
    }
    .input-minimal:focus { border-bottom-color: var(--primary-red); }

    .btn-primary {
      background-color: var(--text-black);
      color: white;
      padding: 12px 30px;
      text-transform: uppercase;
      font-weight: 600;
      letter-spacing: 1px;
      border: 1px solid var(--text-black);
      transition: all 0.3s ease;
      font-size: 0.8rem;
      cursor: pointer;
      display: flex; justify-content: center; items-center; gap: 8px;
    }
    .btn-primary:hover {
      background-color: var(--primary-red);
      border-color: var(--primary-red);
    }
    .btn-primary:disabled { background-color: #ccc; border-color: #ccc; cursor: not-allowed; }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #f1f1f1; }
    ::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--primary-red); }
  `}</style>
);

// --- DATOS ---
const PRODUCTS = [
  // Ropa
  { id: 1, name: "Hoodie Oversized Black", category: "Ropa", subcategory: "Hoodies", price: 890.00, img: "https://images.unsplash.com/photo-1556821840-3a63f95609a7?auto=format&fit=crop&q=80&w=600", tag: "HOT", sizes: ["S","M","L","XL"], colors: ["#000", "#333"], rating: 4.8 },
  { id: 2, name: "Camisa Oxford White", category: "Ropa", subcategory: "Camisas", price: 650.00, img: "https://images.unsplash.com/photo-1596755094514-f87e34085b2c?auto=format&fit=crop&q=80&w=600", tag: "NEW", sizes: ["S","M","L"], colors: ["#FFF", "#EFEFEF"], rating: 4.5 },
  { id: 3, name: "Chamarra Bomber Green", category: "Ropa", subcategory: "Chamarras", price: 1200.00, img: "https://images.unsplash.com/photo-1591047139829-d91aecb6caea?auto=format&fit=crop&q=80&w=600", sizes: ["M","L","XL"], colors: ["#2E7D32"], rating: 4.9 },
  { id: 4, name: "Polo Classic Navy", category: "Ropa", subcategory: "Polos", price: 450.00, img: "https://images.unsplash.com/photo-1626557981101-aae6f84aa6ff?auto=format&fit=crop&q=80&w=600", sizes: ["S","M","L"], colors: ["#0D47A1"], rating: 4.2 },
  { id: 5, name: "Abrigo Largo Wool", category: "Ropa", subcategory: "Abrigos", price: 2500.00, img: "https://images.unsplash.com/photo-1539533018447-63fcce2678e3?auto=format&fit=crop&q=80&w=600", sizes: ["M","L"], colors: ["#5D4037"], rating: 5.0 },
  { id: 6, name: "T-Shirt Gr√°fica 'Void'", category: "Ropa", subcategory: "Hombre", price: 350.00, img: "https://images.unsplash.com/photo-1576566588028-4147f3842f27?auto=format&fit=crop&q=80&w=600", tag: "BEST", sizes: ["XS","S","M","L","XL"], colors: ["#000", "#FFF"], rating: 4.7 },
  { id: 7, name: "Vestido Midi Floral", category: "Ropa", subcategory: "Mujer", price: 780.00, img: "https://images.unsplash.com/photo-1572804013309-59a88b7e92f1?auto=format&fit=crop&q=80&w=600", sizes: ["S","M"], colors: ["#FCE4EC"], rating: 4.6 },
  { id: 8, name: "Hoodie Tie-Dye", category: "Ropa", subcategory: "Hoodies", price: 950.00, img: "https://images.unsplash.com/photo-1588175996685-a40693ee1087?auto=format&fit=crop&q=80&w=600", sizes: ["M","L"], colors: ["#E1BEE7"], rating: 4.4 },
  // Digital
  { id: 9, name: "Logo Design Pro", category: "Digital", subcategory: "Comisiones", price: 1500.00, img: "https://images.unsplash.com/photo-1626785774573-4b799312c95d?auto=format&fit=crop&q=80&w=600", tag: "SERVICE", rating: 5.0 },
  { id: 10, name: "Stream Overlay Pack", category: "Digital", subcategory: "Comisiones", price: 800.00, img: "https://images.unsplash.com/photo-1550745165-9bc0b252726f?auto=format&fit=crop&q=80&w=600", rating: 4.8 },
  // Prints
  { id: 12, name: "Poster 'Cyber Skull'", category: "Prints", subcategory: "V Ruzz", price: 400.00, img: "https://images.unsplash.com/photo-1578301978693-85fa9c0320b9?auto=format&fit=crop&q=80&w=600", tag: "COLLAB", rating: 4.9 },
  { id: 13, name: "Lienzo 'Red Splash'", category: "Prints", subcategory: "X Redstripe", price: 1200.00, img: "https://images.unsplash.com/photo-1579783902614-a3fb39279c0f?auto=format&fit=crop&q=80&w=600", rating: 4.7 },
  { id: 18, name: "Tote Bag Minimal", category: "Accesorios", subcategory: "Mujer", price: 250.00, img: "https://images.unsplash.com/photo-1597484662317-9bd7bdda2907?auto=format&fit=crop&q=80&w=600", rating: 4.3 },
  { id: 20, name: "Chamarra Denim Custom", category: "Ropa", subcategory: "Chamarras", price: 1800.00, img: "https://images.unsplash.com/photo-1516257984-b1b4d8c9230e?auto=format&fit=crop&q=80&w=600", tag: "UNIQUE", sizes: ["M","L"], colors: ["#1A237E"], rating: 5.0 },
];

const SEARCH_HISTORY_MOCK = ["Hoodies negras", "Dise√±o de logos", "Posters cyberpunk", "Camisas formales"];

// --- APP COMPONENT ---
export default function App() {
  const [user, setUser] = useState(null); 
  const [view, setView] = useState('home'); 
  const [cart, setCart] = useState([]);
  const [orders, setOrders] = useState([]); 
  const [wishlist, setWishlist] = useState([]);
  const [showCart, setShowCart] = useState(false);
  const [quickViewProduct, setQuickViewProduct] = useState(null);
  const [chatMessages, setChatMessages] = useState([
    { id: 1, sender: 'admin', text: '¬°Hola! Recib√≠ tu solicitud de comisi√≥n. ¬øTienes referencias?', time: '10:00 AM' }
  ]);
  const [isSearchActiveGlobal, setIsSearchActiveGlobal] = useState(false);

  useEffect(() => {
    const savedUser = localStorage.getItem('redstripe_user');
    if (savedUser) {
      const parsedUser = JSON.parse(savedUser);
      setUser(parsedUser);
      setView(parsedUser.role === 'admin' ? 'dashboard' : 'home');
    }
  }, []);

  const handleLogin = (userData) => {
    setUser(userData);
    localStorage.setItem('redstripe_user', JSON.stringify(userData));
    setView(userData.role === 'admin' ? 'dashboard' : 'home');
  };

  const handleLogout = () => {
    setUser(null);
    localStorage.removeItem('redstripe_user');
    setView('home');
  };

  const addToCart = (product, size = null, color = null) => {
    setCart([...cart, { ...product, selectedSize: size, selectedColor: color, cartId: Date.now() }]);
    setShowCart(true); 
  };

  const createOrder = (newOrder) => {
    setOrders([newOrder, ...orders]);
    setCart([]); 
  };

  const handleWishlist = (product) => {
    if (wishlist.some(p => p.id === product.id)) {
      setWishlist(wishlist.filter(p => p.id !== product.id));
    } else {
      setWishlist([...wishlist, product]);
    }
  };

  const handleSendMessage = (text, img = null) => {
    const newMsg = { id: Date.now(), sender: 'user', text, img, time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) };
    setChatMessages([...chatMessages, newMsg]);
    setTimeout(() => {
        setChatMessages(prev => [...prev, { id: Date.now() + 1, sender: 'admin', text: 'Entendido, lo revisar√© pronto.', time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) }]);
    }, 2000);
  };

  if (!user) return <ModernAuth onLogin={handleLogin} />;

  return (
    <>
      <GlobalStyles />
      {quickViewProduct && (
        <QuickViewModal 
          product={quickViewProduct} 
          onClose={() => setQuickViewProduct(null)} 
          addToCart={addToCart}
          wishlist={wishlist}
          onWishlistClick={handleWishlist}
        />
      )}
      
      {user.role === 'client' || user.role === 'guest' ? (
        <div className="min-h-screen bg-gray-50 flex flex-col pt-20"> 
           <TopNavigation 
              user={user} 
              setView={setView} 
              activeView={view} 
              cartCount={cart.length} 
              openCart={() => setShowCart(true)}
              wishlistCount={wishlist.length}
              externalSearchActive={isSearchActiveGlobal}
              setExternalSearchActive={setIsSearchActiveGlobal}
           />
           
           <main className="flex-1 w-full max-w-[1600px] mx-auto p-8 fade-in relative">
              {view === 'home' && (
                <ClientHome 
                  setQuickViewProduct={setQuickViewProduct} 
                  addToCart={addToCart} 
                  wishlist={wishlist}
                  onWishlistClick={handleWishlist}
                />
              )}
              {view === 'commissions' && <CommissionsView />}
              {view === 'portfolio' && <PortfolioView />}
              {view === 'profile' && (
                  <ProfileView 
                    user={user} 
                    logout={handleLogout} 
                    wishlist={wishlist} 
                    chatMessages={chatMessages}
                    onSendMessage={handleSendMessage}
                    orders={orders}
                  />
              )}
           </main>

           <CartDrawer 
             show={showCart} 
             onClose={() => setShowCart(false)} 
             cart={cart} 
             setCart={setCart}
             orders={orders}
             createOrder={createOrder}
           />
           
           {/* CHATBOT GLOBAL */}
           <RedstripeBot setView={setView} activateSearch={() => setIsSearchActiveGlobal(true)} />

        </div>
      ) : (
        <AdminLayout user={user} setUser={handleLogout} />
      )}
    </>
  );
}

// ------------------------------------------------------------------
// --- CLIENTE WEB: BARRA SUPERIOR (HEADER) ---
// ------------------------------------------------------------------

const TopNavigation = ({ user, setView, activeView, cartCount, openCart, wishlistCount, externalSearchActive, setExternalSearchActive }) => {
    
    return (
        <>
            {externalSearchActive && <div className="fixed inset-0 bg-black/40 z-40 backdrop-blur-sm" onClick={() => setExternalSearchActive(false)} />}
            
            <header className="fixed top-0 inset-x-0 h-20 bg-white border-b border-gray-200 z-50 flex items-center justify-between px-6 md:px-12 shadow-sm transition-all">
                {/* Logo & Buscador */}
                <div className="flex items-center gap-8 md:gap-12 flex-1">
                    <div className="cursor-pointer" onClick={() => setView('home')}>
                        <h1 className="text-2xl font-bebas leading-none select-none tracking-tight">
                            REDSTRIPE<br/><span className="text-[var(--primary-red)]">MARK</span>
                        </h1>
                    </div>

                    {/* Buscador Integrado */}
                    <div className="relative max-w-md w-full hidden md:block group">
                        <div className={`relative z-50 transition-all ${externalSearchActive ? 'scale-100 ring-4 ring-gray-100 rounded-lg' : ''}`}>
                            <input 
                                type="text" 
                                placeholder="Buscar productos, estilos..." 
                                className="w-full bg-gray-100 border-none rounded-lg py-2.5 pl-10 pr-4 text-sm focus:bg-white focus:ring-1 focus:ring-[var(--primary-red)] outline-none transition-all"
                                onFocus={() => setExternalSearchActive(true)}
                                autoFocus={externalSearchActive}
                            />
                            <Search className="absolute left-3 top-2.5 text-gray-400 group-focus-within:text-[var(--primary-red)]" size={18} />
                        </div>
                        
                        {/* Overlay de B√∫squeda */}
                        {externalSearchActive && (
                            <div className="absolute top-full left-0 right-0 mt-2 bg-white shadow-2xl rounded-xl p-6 z-50 border border-gray-100 fade-in w-[120%] -ml-[10%]">
                                <div className="mb-6">
                                    <h4 className="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-3">Recientes</h4>
                                    {SEARCH_HISTORY_MOCK.map((item, i) => (
                                        <div key={i} className="flex items-center gap-3 py-2 text-sm text-gray-600 hover:text-[var(--primary-red)] cursor-pointer hover:bg-gray-50 px-2 rounded transition-colors">
                                            <Clock size={14} className="opacity-50" /> {item}
                                        </div>
                                    ))}
                                </div>
                                <div>
                                    <h4 className="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-3">Tendencias Ahora</h4>
                                    <div className="flex flex-wrap gap-2">
                                        {['Chamarras', 'Digital Assets', 'Oversized', 'Prints', 'Rebajas'].map(tag => (
                                            <span key={tag} className="bg-gray-100 text-xs px-3 py-1.5 rounded-full hover:bg-black hover:text-white cursor-pointer transition-colors border border-transparent hover:border-black font-medium">{tag}</span>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>

                {/* Navegaci√≥n Derecha */}
                <div className="flex items-center gap-2 md:gap-6">
                    {/* Men√∫ Links */}
                    <nav className="hidden lg:flex items-center gap-1">
                        <NavButton label="Explorar" active={activeView === 'home'} onClick={() => setView('home')} icon={Grid} />
                        <NavButton label="Comisiones" active={activeView === 'commissions'} onClick={() => setView('commissions')} icon={Briefcase} />
                        <NavButton label="Portafolio" active={activeView === 'portfolio'} onClick={() => setView('portfolio')} icon={Layers} />
                    </nav>

                    <div className="h-6 w-px bg-gray-200 hidden lg:block"></div>

                    {/* Iconos Acci√≥n */}
                    <div className="flex items-center gap-2">
                         <button onClick={() => setView('profile')} className="p-2 hover:bg-gray-100 rounded-full relative group transition-colors" title="Mi Perfil">
                            <User size={22} className={activeView === 'profile' ? "text-[var(--primary-red)]" : "text-gray-700"} />
                            {wishlistCount > 0 && <span className="absolute top-1 right-1 w-2.5 h-2.5 bg-[var(--primary-red)] rounded-full border-2 border-white"></span>}
                         </button>
                         
                         <button onClick={openCart} className="flex items-center gap-2 bg-black text-white px-4 py-2 rounded-full hover:bg-[var(--primary-red)] transition-all shadow-md group">
                            <ShoppingBag size={18} />
                            <span className="text-sm font-bold hidden md:inline">Carrito</span>
                            {cartCount > 0 && <span className="bg-white text-black text-[10px] font-bold w-5 h-5 flex items-center justify-center rounded-full ml-1">{cartCount}</span>}
                         </button>
                    </div>
                </div>
            </header>
        </>
    );
}

const NavButton = ({ label, active, onClick, icon: Icon }) => (
    <button 
        onClick={onClick} 
        className={`px-4 py-2 rounded-lg text-sm font-bold transition-all flex items-center gap-2 ${active ? 'text-black bg-gray-100' : 'text-gray-500 hover:text-black hover:bg-gray-50'}`}
    >
        <Icon size={16} className={active ? "text-black" : "text-gray-400"} />
        {label}
    </button>
);


// --- REDSTRIPE BOT (Chatbot LIBRE + WhatsApp) ---
const RedstripeBot = ({ setView, activateSearch }) => {
    const [isOpen, setIsOpen] = useState(false);
    const [inputMsg, setInputMsg] = useState("");
    const [messages, setMessages] = useState([
        { type: 'bot', text: '¬°Hola! Soy el asistente de Redstripe Mark. ¬øEn qu√© te puedo ayudar hoy? Escribe algo o elige una opci√≥n.' }
    ]);
    const [showOptions, setShowOptions] = useState(true);

    const whatsappLink = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent("Hola, vengo de tu pagina redstripe mark, necesito ayuda en algo")}`;
    const gmailComposeLink = `https://mail.google.com/mail/?view=cm&fs=1&to=${CONTACT_EMAIL}&su=Consulta%20Redstripe%20Mark&body=Hola%20Cris,%20vengo%20de%20tu%20tienda...`;

    const processMessage = (text) => {
        const lowerText = text.toLowerCase();
        let botResponse = {};

        if (lowerText.includes("comisi") || lowerText.includes("dise√±o") || lowerText.includes("logo")) {
            botResponse = { type: 'bot', text: '¬°Entendido! Si buscas servicios de dise√±o o arte, nuestro apartado de Comisiones es el lugar ideal. Te llevo all√≠.' };
            setView('commissions');
        } else if (lowerText.includes("ropa") || lowerText.includes("camisa") || lowerText.includes("hoodie") || lowerText.includes("prenda") || lowerText.includes("buscar")) {
            botResponse = { type: 'bot', text: 'Para encontrar la prenda perfecta, te activo nuestra barra de b√∫squeda superior. ¬°Adelante!' };
            activateSearch();
        } else if (lowerText.includes("contacto") || lowerText.includes("correo") || lowerText.includes("email") || lowerText.includes("whatsapp") || lowerText.includes("ayuda")) {
            botResponse = { 
                type: 'bot', 
                text: 'Claro, aqu√≠ tienes nuestras v√≠as de contacto directo.',
                isContact: true 
            };
        } else {
            botResponse = { type: 'bot', text: 'Mmm, no estoy seguro de entender al 100%, pero aqu√≠ tienes mis opciones principales:' };
            setTimeout(() => setShowOptions(true), 1000);
        }
        return botResponse;
    };

    const handleSend = () => {
        if (!inputMsg.trim()) return;
        
        const userText = inputMsg;
        setMessages(prev => [...prev, { type: 'user', text: userText }]);
        setInputMsg("");
        setShowOptions(false);

        setTimeout(() => {
            const response = processMessage(userText);
            setMessages(prev => [...prev, response]);
        }, 600);
    };

    const handleOption = (option) => {
        const userMsg = { type: 'user', text: option };
        setMessages(prev => [...prev, userMsg]);
        setShowOptions(false);

        setTimeout(() => {
            let botResponse = {};
            if (option === 'Busco comisiones') {
                botResponse = { type: 'bot', text: '¬°Genial! Te llevo al apartado de comisiones ahora mismo.' };
                setView('commissions');
            } else if (option === 'Busco una prenda') {
                botResponse = { type: 'bot', text: 'Claro, usa nuestra barra de b√∫squeda superior.' };
                activateSearch();
            } else if (option === 'Contacto / Info') {
                botResponse = { 
                    type: 'bot', 
                    text: 'Puedes contactarnos directamente por correo o WhatsApp.',
                    isContact: true 
                };
            }
            setMessages(prev => [...prev, botResponse]);
        }, 600);
    };

    return (
        <div className="fixed bottom-6 left-6 z-50 flex flex-col items-start gap-3 font-sans">
             {/* VENTANA DE CHAT */}
             {isOpen && (
                 <div className="bg-white rounded-2xl shadow-2xl w-80 mb-2 border border-gray-200 overflow-hidden slide-up flex flex-col h-[450px]">
                     <div className="bg-black text-white p-4 flex justify-between items-center shrink-0">
                         <div className="flex items-center gap-2">
                             <div className="w-8 h-8 bg-[var(--primary-red)] rounded-full flex items-center justify-center font-bold text-xs">RM</div>
                             <span className="font-bebas text-lg">Asistente Virtual</span>
                         </div>
                         <button onClick={() => setIsOpen(false)}><X size={18}/></button>
                     </div>
                     
                     <div className="p-4 bg-gray-50 flex-1 overflow-y-auto space-y-3 custom-scrollbar">
                         {messages.map((msg, idx) => (
                             <div key={idx} className={`flex ${msg.type === 'user' ? 'justify-end' : 'justify-start'}`}>
                                 <div className={`max-w-[85%] p-3 rounded-xl text-sm ${msg.type === 'user' ? 'bg-black text-white rounded-br-none' : 'bg-white border border-gray-200 text-gray-800 rounded-bl-none shadow-sm'}`}>
                                     {msg.text}
                                     {msg.isContact && (
                                         <div className="mt-3 space-y-2">
                                             <a href={gmailComposeLink} target="_blank" rel="noreferrer" className="flex items-center justify-center gap-2 w-full py-2 bg-red-50 hover:bg-red-100 rounded text-xs font-bold text-red-600 border border-red-200 transition-colors">
                                                 <Mail size={14} /> Redactar en Gmail
                                             </a>
                                             <a href={whatsappLink} target="_blank" rel="noreferrer" className="flex items-center justify-center gap-2 w-full py-2 bg-green-500 hover:bg-green-600 rounded text-xs font-bold text-white transition-colors">
                                                 <MessageCircle size={14} /> WhatsApp Directo
                                             </a>
                                         </div>
                                     )}
                                 </div>
                             </div>
                         ))}
                         {showOptions && (
                             <div className="grid grid-cols-1 gap-2 mt-2">
                                 <button onClick={() => handleOption('Busco comisiones')} className="text-left px-3 py-2 text-xs font-bold border rounded bg-white hover:bg-gray-50 text-gray-600">üé® Busco comisiones</button>
                                 <button onClick={() => handleOption('Busco una prenda')} className="text-left px-3 py-2 text-xs font-bold border rounded bg-white hover:bg-gray-50 text-gray-600">üëï Busco una prenda</button>
                                 <button onClick={() => handleOption('Contacto / Info')} className="text-left px-3 py-2 text-xs font-bold border rounded bg-white hover:bg-gray-50 text-gray-600">‚ÑπÔ∏è Contacto / Info</button>
                             </div>
                         )}
                     </div>

                     {/* INPUT AREA */}
                     <div className="p-3 bg-white border-t border-gray-100 flex gap-2 shrink-0">
                        <input 
                            type="text" 
                            value={inputMsg}
                            onChange={(e) => setInputMsg(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && handleSend()}
                            placeholder="Escribe tu mensaje..."
                            className="flex-1 bg-gray-100 rounded-full px-4 py-2 text-xs outline-none focus:ring-1 focus:ring-black"
                        />
                        <button onClick={handleSend} className="p-2 bg-black text-white rounded-full hover:bg-[var(--primary-red)] transition-colors">
                            <Send size={14} />
                        </button>
                     </div>
                 </div>
             )}

             {/* BOTONES FLOTANTES */}
             <div className="flex items-center gap-3">
                <button 
                    onClick={() => setIsOpen(!isOpen)} 
                    className="w-14 h-14 bg-black hover:bg-[var(--primary-red)] text-white rounded-full shadow-xl flex items-center justify-center transition-colors group"
                >
                    {isOpen ? <X size={24}/> : <MessageSquare size={24} className="group-hover:scale-110 transition-transform"/>}
                </button>
             </div>
        </div>
    );
};


// --- VISTA PRINCIPAL (ADAPTADA AL FULL WIDTH) ---
const ClientHome = ({ setQuickViewProduct, addToCart, wishlist, onWishlistClick }) => {
    const bestSellers = PRODUCTS.filter(p => p.tag === 'HOT' || p.tag === 'BEST').slice(0, 3);
    
    return (
        <div className="space-y-12 pb-20">
            {/* Header Banner - Ahora Full Width */}
            <header className="flex flex-col lg:flex-row gap-6 mb-8">
                {/* Visual Categories */}
                <div className="flex-1 grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="bg-[#111] rounded-2xl p-8 text-white relative overflow-hidden group cursor-pointer h-64 md:h-80 flex flex-col justify-end">
                        <div className="relative z-10 transform translate-y-2 group-hover:translate-y-0 transition-transform">
                            <h3 className="font-bebas text-5xl mb-1 leading-none">ROPA<br/><span className="text-gray-500">URBANA</span></h3>
                            <p className="text-sm text-gray-300 opacity-0 group-hover:opacity-100 transition-opacity mt-2">Nueva colecci√≥n 2024 disponible.</p>
                        </div>
                        <img src="https://images.unsplash.com/photo-1523381294911-8d3cead13475?auto=format&fit=crop&w=800" className="absolute inset-0 w-full h-full object-cover opacity-50 group-hover:scale-110 transition-transform duration-700 mix-blend-overlay" />
                    </div>
                    <div className="bg-[#111] rounded-2xl p-8 text-white relative overflow-hidden group cursor-pointer h-64 md:h-80 flex flex-col justify-end">
                        <div className="relative z-10 transform translate-y-2 group-hover:translate-y-0 transition-transform">
                            <h3 className="font-bebas text-5xl mb-1 leading-none">DIGITAL<br/><span className="text-gray-500">ASSETS</span></h3>
                            <p className="text-sm text-gray-300 opacity-0 group-hover:opacity-100 transition-opacity mt-2">Logos, Overlays y m√°s.</p>
                        </div>
                        <img src="https://images.unsplash.com/photo-1626785774573-4b799312c95d?auto=format&fit=crop&w=800" className="absolute inset-0 w-full h-full object-cover opacity-50 group-hover:scale-110 transition-transform duration-700 mix-blend-overlay" />
                    </div>
                </div>

                {/* Sidebar Promocional (Derecha) */}
                <div className="w-full lg:w-80 bg-white border border-gray-100 rounded-2xl p-6 shadow-sm flex flex-col h-auto lg:h-80">
                    <div className="flex justify-between items-center mb-6">
                        <h3 className="font-bold text-sm uppercase tracking-widest">Destacado</h3>
                        <Star size={16} className="text-[var(--primary-red)] fill-current" />
                    </div>
                    <div className="flex-1 overflow-y-auto space-y-4 pr-2 custom-scrollbar">
                        {bestSellers.map(p => (
                            <div key={p.id} className="flex gap-4 items-center group cursor-pointer hover:bg-gray-50 p-2 rounded-lg transition-colors" onClick={() => setQuickViewProduct(p)}>
                                <div className="w-16 h-16 rounded-lg overflow-hidden bg-gray-100 shrink-0">
                                    <img src={p.img} className="w-full h-full object-cover" />
                                </div>
                                <div>
                                    <p className="text-sm font-bold group-hover:text-[var(--primary-red)] transition-colors line-clamp-1">{p.name}</p>
                                    <p className="text-xs text-gray-500 mb-1">{p.category}</p>
                                    <p className="text-xs font-bold text-black">${p.price}</p>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            </header>

            {/* CATALOGO COMPLETO */}
            <section>
                <div className="flex items-end justify-between mb-8 border-b border-gray-200 pb-4">
                    <div>
                        <h2 className="text-4xl font-bebas">Cat√°logo Completo</h2>
                        <p className="text-gray-500 text-sm mt-1">Explora todos nuestros productos disponibles</p>
                    </div>
                    <div className="flex gap-2">
                        <button className="px-4 py-2 text-xs font-bold bg-black text-white rounded-full hover:shadow-lg transition-shadow">Todo</button>
                        <button className="px-4 py-2 text-xs font-bold bg-white border border-gray-200 hover:bg-gray-100 rounded-full transition-colors">Ropa</button>
                        <button className="px-4 py-2 text-xs font-bold bg-white border border-gray-200 hover:bg-gray-100 rounded-full transition-colors">Digital</button>
                    </div>
                </div>

                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-x-8 gap-y-12">
                    {PRODUCTS.map(product => (
                        <InteractiveProductCard 
                            key={product.id} 
                            product={product} 
                            setQuickView={setQuickViewProduct}
                            addToCart={addToCart}
                            isWishlisted={wishlist.some(w => w.id === product.id)}
                            onWishlist={() => onWishlistClick(product)}
                        />
                    ))}
                </div>
            </section>
        </div>
    );
};

// --- OTROS COMPONENTES (Portfolio) ---
const PortfolioView = () => (
    <div className="max-w-4xl mx-auto fade-in text-center py-10">
        <h2 className="text-6xl font-bebas mb-6">Mi Portafolio</h2>
        <p className="text-gray-500 max-w-2xl mx-auto mb-16 text-lg">
            Una colecci√≥n selecta de trabajos realizados para marcas urbanas, streamers y proyectos personales.
            Cada pieza cuenta una historia visual √∫nica.
        </p>
        
        <div className="grid grid-cols-1 md:grid-cols-2 gap-8 mb-16">
            <div className="space-y-8">
                <div className="rounded-2xl overflow-hidden shadow-lg group relative cursor-pointer">
                    <img src="https://images.unsplash.com/photo-1626785774573-4b799312c95d?auto=format&fit=crop&w=800" className="w-full h-auto object-cover transition-transform duration-700 group-hover:scale-105" />
                    <div className="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                         <span className="text-white font-bebas text-3xl">Neon Project</span>
                    </div>
                </div>
                <div className="rounded-2xl overflow-hidden shadow-lg group relative cursor-pointer">
                     <img src="https://images.unsplash.com/photo-1550745165-9bc0b252726f?auto=format&fit=crop&w=800" className="w-full h-auto object-cover transition-transform duration-700 group-hover:scale-105" />
                     <div className="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                         <span className="text-white font-bebas text-3xl">Cyber Room</span>
                    </div>
                </div>
            </div>
            <div className="space-y-8 pt-12">
                 <div className="rounded-2xl overflow-hidden shadow-lg group relative cursor-pointer">
                     <img src="https://images.unsplash.com/photo-1578301978693-85fa9c0320b9?auto=format&fit=crop&w=800" className="w-full h-auto object-cover transition-transform duration-700 group-hover:scale-105" />
                     <div className="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                         <span className="text-white font-bebas text-3xl">Skull Art</span>
                    </div>
                </div>
                 <div className="bg-gray-100 rounded-2xl p-12 flex items-center justify-center text-center">
                    <div>
                        <h3 className="font-bebas text-4xl mb-2">¬øTe gusta lo que ves?</h3>
                        <p className="text-gray-500 mb-6">Trabajemos juntos.</p>
                        <button className="btn-primary w-full">Solicitar Comisi√≥n</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
);

// --- TARJETA DE PRODUCTO CON LOGICA DE 2 SEGUNDOS ---
const InteractiveProductCard = ({ product, setQuickView, addToCart, isWishlisted, onWishlist }) => {
    const timerRef = useRef(null);
    const [progress, setProgress] = useState(0);

    const handleMouseEnter = () => {
        let startTime = Date.now();
        const duration = 2000;
        const interval = setInterval(() => {
            const elapsed = Date.now() - startTime;
            const pct = Math.min((elapsed / duration) * 100, 100);
            setProgress(pct);
        }, 50);

        timerRef.current = {
            timeout: setTimeout(() => {
                setQuickView(product);
                clearInterval(interval);
                setProgress(0);
            }, duration),
            interval: interval
        };
    };

    const handleMouseLeave = () => {
        if (timerRef.current) {
            clearTimeout(timerRef.current.timeout);
            clearInterval(timerRef.current.interval);
            timerRef.current = null;
        }
        setProgress(0);
    };

    return (
        <div 
            className="group relative"
            onMouseEnter={handleMouseEnter}
            onMouseLeave={handleMouseLeave}
        >
            <div className="relative aspect-[3/4] bg-white rounded-xl overflow-hidden mb-4 cursor-pointer shadow-sm group-hover:shadow-md transition-all">
                <img src={product.img} className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" />
                
                {/* Barra de progreso */}
                {progress > 0 && (
                    <div className="absolute top-0 left-0 h-1 bg-[var(--primary-red)] transition-all ease-linear" style={{ width: `${progress}%` }}></div>
                )}

                {product.tag && <span className="absolute top-3 left-3 bg-white/90 backdrop-blur text-[10px] font-bold px-3 py-1 rounded shadow-sm tracking-widest">{product.tag}</span>}
                
                <button 
                    onClick={(e) => { e.stopPropagation(); onWishlist(); }}
                    className="absolute top-3 right-3 p-2 bg-white/90 rounded-full hover:bg-[var(--primary-red)] hover:text-white transition-colors shadow-sm opacity-0 group-hover:opacity-100 transform translate-y-2 group-hover:translate-y-0 duration-300"
                >
                    <Heart size={16} className={isWishlisted ? "fill-red-500 text-red-500 hover:text-white" : ""} />
                </button>
            </div>
            
            <div className="flex justify-between items-start px-1">
                <div>
                    <h3 className="font-bold text-sm mb-1 leading-tight">{product.name}</h3>
                    <p className="text-gray-400 text-[10px] uppercase tracking-wider">{product.category}</p>
                </div>
                <span className="font-bold text-sm bg-gray-50 px-2 py-1 rounded">${product.price}</span>
            </div>
        </div>
    );
};

// --- MODAL VISTA R√ÅPIDA (HOVER 2S) ---
const QuickViewModal = ({ product, onClose, addToCart, wishlist, onWishlistClick }) => {
    const isWishlisted = wishlist.some(w => w.id === product.id);
    const [selectedSize, setSelectedSize] = useState(product.sizes ? product.sizes[0] : null);

    return (
        <div className="fixed inset-0 z-[60] flex items-center justify-center p-4">
            <div className="absolute inset-0 bg-black/40 backdrop-blur-sm" onClick={onClose}></div>
            <div className="relative bg-white rounded-2xl shadow-2xl max-w-2xl w-full overflow-hidden flex flex-col md:flex-row scale-up">
                <button onClick={onClose} className="absolute top-4 right-4 z-10 p-2 bg-white/50 rounded-full hover:bg-white"><X size={20}/></button>
                
                <div className="w-full md:w-1/2 bg-gray-100 h-64 md:h-auto">
                    <img src={product.img} className="w-full h-full object-cover" />
                </div>

                <div className="w-full md:w-1/2 p-8 flex flex-col justify-center">
                    <div className="flex items-center gap-2 mb-2">
                        <span className="bg-[var(--primary-red)] text-white text-[10px] px-2 py-0.5 rounded font-bold uppercase">Vista R√°pida</span>
                        <div className="flex text-yellow-400">
                            {[...Array(5)].map((_, i) => <Star key={i} size={12} fill={i < Math.floor(product.rating || 5) ? "currentColor" : "none"} />)}
                        </div>
                        <span className="text-xs text-gray-400">({product.rating || 5.0})</span>
                    </div>

                    <h2 className="text-2xl font-bebas mb-2">{product.name}</h2>
                    <p className="text-2xl font-bold mb-6">${product.price.toFixed(2)}</p>

                    {product.sizes && (
                        <div className="mb-6">
                            <p className="text-xs font-bold uppercase text-gray-400 mb-2">Selecciona Talla</p>
                            <div className="flex gap-2">
                                {product.sizes.map(s => (
                                    <button 
                                        key={s} 
                                        onClick={() => setSelectedSize(s)}
                                        className={`w-10 h-10 flex items-center justify-center rounded border text-sm font-bold transition-all ${selectedSize === s ? 'bg-black text-white border-black' : 'border-gray-200 hover:border-black'}`}
                                    >
                                        {s}
                                    </button>
                                ))}
                            </div>
                        </div>
                    )}

                    <div className="flex gap-3 mt-auto">
                        <button 
                            onClick={() => { addToCart(product, selectedSize); onClose(); }} 
                            className="flex-1 btn-primary"
                        >
                            A√±adir al Carrito
                        </button>
                        <button 
                            onClick={() => onWishlistClick(product)}
                            className={`p-3 border rounded transition-colors ${isWishlisted ? 'bg-red-50 border-red-200 text-red-500' : 'border-gray-300 hover:bg-gray-50'}`}
                        >
                            <Heart size={20} className={isWishlisted ? "fill-red-500" : ""} />
                        </button>
                    </div>
                </div>
            </div>
        </div>
    );
};

// --- CARRITO AVANZADO + CHECKOUT + RASTREO ---
const CartDrawer = ({ show, onClose, cart, setCart, orders, createOrder }) => {
    const [mode, setMode] = useState('cart'); // 'cart', 'checkout', 'processing', 'success', 'tracking'
    const [activeTab, setActiveTab] = useState('bag'); // 'bag' vs 'orders'
    const [checkoutStep, setCheckoutStep] = useState(1); // 1: Datos, 2: Pago
    
    // Formulario de Pago
    const [formData, setFormData] = useState({ address: '', city: '', card: '', exp: '' });

    const total = cart.reduce((sum, item) => sum + item.price, 0);

    const handleCheckout = () => {
        setMode('processing');
        setTimeout(() => {
            const newOrder = {
                id: `ORD-${Math.floor(Math.random() * 10000)}`,
                date: new Date().toLocaleDateString(),
                arrival: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000).toLocaleDateString(), // 5 d√≠as despu√©s
                items: [...cart],
                total: total,
                status: 'En camino'
            };
            createOrder(newOrder);
            setMode('success');
        }, 3000); 
    };

    if (!show) return null;

    return (
        <div className="fixed inset-0 z-[60] flex justify-end">
            <div className="absolute inset-0 bg-black/50 backdrop-blur-sm" onClick={onClose}></div>
            <div className="relative w-full max-w-md bg-white h-full shadow-2xl flex flex-col slide-in-right">
                
                <div className="p-6 border-b border-gray-100 flex justify-between items-center bg-white z-10">
                    <h2 className="font-bebas text-2xl">
                        {mode === 'cart' && (activeTab === 'bag' ? 'Tu Bolsa' : 'Mis Pedidos')}
                        {mode === 'checkout' && 'Finalizar Compra'}
                        {mode === 'success' && '¬°Compra Exitosa!'}
                    </h2>
                    <button onClick={onClose}><X size={24} /></button>
                </div>

                {mode === 'cart' && (
                    <div className="flex border-b border-gray-100">
                        <button onClick={() => setActiveTab('bag')} className={`flex-1 py-3 text-sm font-bold uppercase ${activeTab === 'bag' ? 'text-[var(--primary-red)] border-b-2 border-[var(--primary-red)]' : 'text-gray-400'}`}>Bolsa ({cart.length})</button>
                        <button onClick={() => setActiveTab('orders')} className={`flex-1 py-3 text-sm font-bold uppercase ${activeTab === 'orders' ? 'text-[var(--primary-red)] border-b-2 border-[var(--primary-red)]' : 'text-gray-400'}`}>Rastreo ({orders.length})</button>
                    </div>
                )}

                <div className="flex-1 overflow-y-auto p-6 bg-gray-50">
                    
                    {/* VISTA BOLSA */}
                    {mode === 'cart' && activeTab === 'bag' && (
                        <>
                            {cart.length === 0 ? (
                                <div className="text-center text-gray-400 py-20">
                                    <ShoppingBag size={48} className="mx-auto mb-4 opacity-50"/>
                                    <p>Tu bolsa est√° vac√≠a.</p>
                                </div>
                            ) : (
                                <div className="space-y-4">
                                    {cart.map(item => (
                                        <div key={item.cartId} className="flex gap-4 bg-white p-3 rounded-lg shadow-sm">
                                            <img src={item.img} className="w-16 h-20 object-cover rounded bg-gray-100" />
                                            <div className="flex-1">
                                                <div className="flex justify-between">
                                                    <h3 className="font-bold text-sm">{item.name}</h3>
                                                    <button onClick={() => setCart(cart.filter(c => c.cartId !== item.cartId))}><Trash2 size={14} className="text-gray-400 hover:text-red-500"/></button>
                                                </div>
                                                <p className="text-xs text-gray-500">{item.selectedSize} | {item.category}</p>
                                                <p className="text-sm font-medium mt-1">${item.price}</p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </>
                    )}

                    {/* VISTA PEDIDOS */}
                    {mode === 'cart' && activeTab === 'orders' && (
                        <div className="space-y-6">
                            {orders.length === 0 ? <p className="text-center text-gray-400 mt-10">A√∫n no tienes pedidos.</p> : orders.map(order => (
                                <div key={order.id} className="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                                    <div className="flex justify-between items-center mb-3 pb-3 border-b border-gray-100">
                                        <div>
                                            <p className="font-bold text-sm">{order.id}</p>
                                            <p className="text-xs text-gray-500">{order.date}</p>
                                        </div>
                                        <span className="bg-green-100 text-green-700 text-[10px] font-bold px-2 py-1 rounded-full uppercase">{order.status}</span>
                                    </div>
                                    <div className="flex items-center gap-3 mb-4">
                                        <div className="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-[var(--primary-red)]"><Truck size={14}/></div>
                                        <div>
                                            <p className="text-xs font-bold text-gray-400 uppercase">Llega el:</p>
                                            <p className="text-sm font-bold">{order.arrival}</p>
                                        </div>
                                    </div>
                                    <div className="flex -space-x-2">
                                        {order.items.slice(0, 3).map((item, i) => (
                                            <img key={i} src={item.img} className="w-8 h-8 rounded-full border-2 border-white object-cover" />
                                        ))}
                                        {order.items.length > 3 && <div className="w-8 h-8 rounded-full bg-gray-200 border-2 border-white flex items-center justify-center text-[10px] font-bold">+{order.items.length - 3}</div>}
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}

                    {/* VISTA CHECKOUT FORM */}
                    {mode === 'checkout' && (
                        <div className="space-y-6 fade-in">
                            <div className="flex items-center justify-between mb-4">
                                <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${checkoutStep >= 1 ? 'bg-black text-white' : 'bg-gray-200'}`}>1</div>
                                <div className="h-0.5 flex-1 bg-gray-200 mx-2"></div>
                                <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${checkoutStep >= 2 ? 'bg-black text-white' : 'bg-gray-200'}`}>2</div>
                            </div>

                            {checkoutStep === 1 ? (
                                <div className="space-y-4">
                                    <h3 className="font-bold">Datos de Env√≠o</h3>
                                    <input placeholder="Direcci√≥n Completa" className="input-minimal" onChange={e => setFormData({...formData, address: e.target.value})} />
                                    <div className="flex gap-4">
                                        <input placeholder="Ciudad" className="input-minimal" onChange={e => setFormData({...formData, city: e.target.value})}/>
                                        <input placeholder="CP" className="input-minimal w-24" />
                                    </div>
                                    <div className="flex gap-2 mt-4">
                                        <button className="flex-1 py-3 border border-gray-300 rounded hover:border-black font-medium text-sm">Est√°ndar (Gratis)</button>
                                        <button className="flex-1 py-3 border border-[var(--primary-red)] bg-red-50 text-[var(--primary-red)] rounded font-medium text-sm">Express (+$99)</button>
                                    </div>
                                    <button onClick={() => setCheckoutStep(2)} className="w-full btn-primary mt-6">Siguiente</button>
                                </div>
                            ) : (
                                <div className="space-y-4 fade-in">
                                    <h3 className="font-bold">M√©todo de Pago</h3>
                                    <div className="bg-gray-100 p-4 rounded-lg flex items-center gap-3 mb-4">
                                        <CreditCard size={20}/>
                                        <input placeholder="N√∫mero de Tarjeta" className="bg-transparent outline-none flex-1 text-sm" />
                                    </div>
                                    <div className="flex gap-4">
                                        <input placeholder="MM/YY" className="input-minimal" />
                                        <input placeholder="CVC" className="input-minimal" />
                                    </div>
                                    <button onClick={handleCheckout} className="w-full btn-primary mt-6 flex justify-between">
                                        <span>Pagar Ahora</span>
                                        <span>${total.toFixed(2)}</span>
                                    </button>
                                </div>
                            )}
                        </div>
                    )}

                    {mode === 'processing' && (
                        <div className="h-full flex flex-col items-center justify-center text-center fade-in">
                            <div className="w-16 h-16 border-4 border-gray-200 border-t-[var(--primary-red)] rounded-full animate-spin mb-6"></div>
                            <h3 className="font-bebas text-2xl">Procesando Pago...</h3>
                        </div>
                    )}

                    {mode === 'success' && (
                        <div className="h-full flex flex-col items-center justify-center text-center fade-in">
                            <div className="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center text-green-600 mb-6 scale-up">
                                <Check size={40} strokeWidth={3} />
                            </div>
                            <h3 className="font-bebas text-3xl mb-2">¬°Orden Confirmada!</h3>
                            <p className="text-gray-500 text-sm mb-8 px-8">Hemos recibido tu pedido correctamente. Puedes rastrearlo en la secci√≥n de "Rastreo".</p>
                            <button onClick={() => { setMode('cart'); setActiveTab('orders'); }} className="btn-primary">Ver Mi Pedido</button>
                        </div>
                    )}

                </div>

                {mode === 'cart' && activeTab === 'bag' && cart.length > 0 && (
                    <div className="p-6 border-t border-gray-100 bg-white">
                        <div className="flex justify-between items-center mb-4">
                            <span className="font-bold uppercase text-sm">Total</span>
                            <span className="font-bebas text-2xl">${total.toFixed(2)}</span>
                        </div>
                        <button onClick={() => setMode('checkout')} className="w-full btn-primary py-4">Proceder al Pago</button>
                    </div>
                )}
            </div>
        </div>
    );
};

// --- VISTA COMISIONES CON FORMULARIO DETALLADO ---
const CommissionsView = () => (
    <div className="fade-in max-w-2xl mx-auto py-10">
        <h2 className="text-5xl font-bebas mb-2 text-center">Comisiones Digitales</h2>
        <p className="text-gray-500 text-center mb-10">Transformamos tu idea en realidad visual.</p>

        <div className="bg-white p-8 rounded-xl shadow-sm border border-gray-100">
            <h3 className="font-bold text-lg mb-6">Detalles del Proyecto</h3>
            
            <div className="space-y-5">
                <div>
                    <label className="text-xs font-bold text-gray-500 uppercase">Nombre del Proyecto</label>
                    <input type="text" className="input-minimal" placeholder="Ej: Logo para marca de ropa" />
                </div>

                <div className="grid grid-cols-2 gap-6">
                    <div>
                        <label className="text-xs font-bold text-gray-500 uppercase">Tipo de Trabajo</label>
                        <select className="input-minimal bg-transparent">
                            <option>Logotipo</option>
                            <option>Ilustraci√≥n</option>
                            <option>Stream Pack</option>
                            <option>Otro</option>
                        </select>
                    </div>
                    <div>
                        <label className="text-xs font-bold text-gray-500 uppercase">Presupuesto Aprox.</label>
                        <input type="text" className="input-minimal" placeholder="$ USD" />
                    </div>
                </div>

                <div>
                    <label className="text-xs font-bold text-gray-500 uppercase">Descripci√≥n Detallada</label>
                    <textarea className="input-minimal resize-none h-24" placeholder="Describe estilos, colores, vibras..."></textarea>
                </div>

                <div>
                    <label className="text-xs font-bold text-gray-500 uppercase mb-2 block">Imagen de Referencia</label>
                    <div className="border-2 border-dashed border-gray-200 rounded-lg p-8 flex flex-col items-center justify-center text-gray-400 hover:border-[var(--primary-red)] hover:text-[var(--primary-red)] transition-colors cursor-pointer bg-gray-50">
                        <ImageIcon size={32} className="mb-2"/>
                        <span className="text-xs font-bold">Click para subir o arrastra aqu√≠</span>
                    </div>
                </div>

                <button className="w-full btn-primary mt-4">Enviar Solicitud y Cotizar</button>
            </div>
        </div>
    </div>
);

// --- PERFIL CON CHAT DE COMISIONES ---
const ProfileView = ({ user, logout, wishlist, chatMessages, onSendMessage, orders }) => {
    const [tab, setTab] = useState('details');
    const [msgText, setMsgText] = useState("");

    const send = () => {
        if(msgText.trim()) {
            onSendMessage(msgText);
            setMsgText("");
        }
    };

    return (
        <div className="max-w-5xl mx-auto fade-in h-full flex flex-col py-6">
            <h2 className="text-4xl font-bebas mb-6">Hola, {user.name.split(' ')[0]}</h2>
            
            <div className="flex gap-6 border-b border-gray-200 mb-8 overflow-x-auto items-center">
                {['details', 'wishlist', 'commissions'].map(t => (
                    <button 
                        key={t}
                        onClick={() => setTab(t)}
                        className={`pb-3 text-sm font-bold uppercase transition-colors whitespace-nowrap ${tab === t ? 'border-b-2 border-black text-black' : 'text-gray-400 hover:text-black'}`}
                    >
                        {t === 'details' ? 'Mis Datos' : t === 'wishlist' ? 'Wishlist' : 'Chat Comisiones'}
                    </button>
                ))}
                
                {/* BOT√ìN PARCIAL 3 */}
                <a 
                    href="https://crisshdzhrra.github.io/CrissHdzHrra.github.io-/" 
                    target="_blank"
                    rel="noopener noreferrer"
                    className="ml-auto pb-3 text-sm font-bold uppercase text-[var(--primary-red)] flex items-center gap-2 hover:opacity-80 transition-opacity"
                >
                    Parcial 3 <ExternalLink size={14} />
                </a>
            </div>

            <div className="flex-1">
                {tab === 'details' && (
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div className="bg-white p-6 rounded-xl border border-gray-100 shadow-sm">
                            <h3 className="font-bold mb-4 flex items-center gap-2"><User size={18}/> Informaci√≥n Personal</h3>
                            <div className="space-y-4">
                                <div><p className="text-xs text-gray-400 uppercase">Nombre</p><p className="font-medium">{user.name}</p></div>
                                <div><p className="text-xs text-gray-400 uppercase">Email</p><p className="font-medium">{user.email}</p></div>
                                <div><p className="text-xs text-gray-400 uppercase">Pa√≠s</p><p className="font-medium">{user.country || 'No especificado'}</p></div>
                            </div>
                            <button onClick={logout} className="mt-8 text-red-500 text-xs font-bold uppercase flex items-center gap-2 hover:bg-red-50 p-2 rounded w-fit"><LogOut size={14}/> Cerrar Sesi√≥n</button>
                        </div>
                        <div className="bg-gradient-to-br from-gray-900 to-black p-6 rounded-xl text-white shadow-lg">
                            <h3 className="font-bebas text-2xl mb-1">REDSTRIPE MEMBER</h3>
                            <p className="text-xs text-gray-400 mb-8">Nivel: {user.role === 'guest' ? 'Invitado' : 'Iniciado'}</p>
                            <div className="flex justify-between items-end">
                                <div>
                                    <p className="text-[10px] uppercase tracking-widest text-gray-500">Miembro desde</p>
                                    <p className="font-mono">2024</p>
                                </div>
                                <ShieldCheck size={32} className="text-[var(--primary-red)] opacity-50"/>
                            </div>
                        </div>
                    </div>
                )}

                {tab === 'wishlist' && (
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-6">
                        {wishlist.length === 0 ? <p className="text-gray-400">Tu lista de deseos est√° vac√≠a.</p> : wishlist.map(p => (
                            <div key={p.id} className="bg-white rounded-lg border border-gray-100 overflow-hidden group">
                                <div className="aspect-square relative">
                                    <img src={p.img} className="w-full h-full object-cover"/>
                                </div>
                                <div className="p-3">
                                    <h4 className="font-bold text-xs truncate">{p.name}</h4>
                                    <p className="text-xs text-gray-500">${p.price}</p>
                                </div>
                            </div>
                        ))}
                    </div>
                )}

                {tab === 'commissions' && (
                    <div className="bg-white rounded-xl border border-gray-200 h-[500px] flex flex-col shadow-sm overflow-hidden">
                        <div className="p-4 border-b border-gray-100 bg-gray-50 flex items-center gap-3">
                            <div className="w-10 h-10 bg-black rounded-full flex items-center justify-center text-white font-bold">MK</div>
                            <div>
                                <h4 className="font-bold text-sm">Mark Crimson (Admin)</h4>
                                <p className="text-xs text-green-600 flex items-center gap-1"><span className="w-1.5 h-1.5 bg-green-500 rounded-full"></span> En l√≠nea</p>
                            </div>
                        </div>

                        <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50/50">
                            {chatMessages.map(msg => (
                                <div key={msg.id} className={`flex ${msg.sender === 'user' ? 'justify-end' : 'justify-start'}`}>
                                    <div className={`max-w-[70%] rounded-xl p-3 text-sm ${msg.sender === 'user' ? 'bg-black text-white rounded-br-none' : 'bg-white border border-gray-200 rounded-bl-none'}`}>
                                        {msg.img && <img src={msg.img} className="rounded-lg mb-2 max-w-full" />}
                                        <p>{msg.text}</p>
                                        <p className={`text-[10px] mt-1 text-right ${msg.sender === 'user' ? 'text-gray-400' : 'text-gray-400'}`}>{msg.time}</p>
                                    </div>
                                </div>
                            ))}
                        </div>

                        <div className="p-4 border-t border-gray-100 bg-white flex gap-2 items-center">
                            <button className="p-2 text-gray-400 hover:text-black hover:bg-gray-100 rounded-full">
                                <Paperclip size={20}/>
                            </button>
                            <input 
                                type="text" 
                                value={msgText}
                                onChange={(e) => setMsgText(e.target.value)}
                                onKeyPress={(e) => e.key === 'Enter' && send()}
                                placeholder="Escribe un mensaje..." 
                                className="flex-1 bg-gray-100 rounded-full px-4 py-2 text-sm outline-none focus:ring-1 focus:ring-black"
                            />
                            <button onClick={send} className="p-2 bg-[var(--primary-red)] text-white rounded-full hover:bg-red-700 transition-colors">
                                <Send size={18} />
                            </button>
                        </div>
                    </div>
                )}
            </div>
        </div>
    );
};

// --- AUTH MODERNA CON SPLIT SCREEN ---
const ModernAuth = ({ onLogin }) => {
  const [isLogin, setIsLogin] = useState(true);
  const [formData, setFormData] = useState({ email: '', password: '', name: '' });

  const handleSubmit = () => {
      const user = {
          name: formData.name || 'Usuario Nuevo',
          email: formData.email,
          role: formData.email.includes('admin') ? 'admin' : 'client'
      };
      onLogin(user);
  };

  const handleGuest = () => {
      onLogin({
          name: 'Invitado',
          email: 'guest@redstripe.com',
          role: 'guest'
      });
  };

  return (
    <div className="flex h-screen w-full bg-white overflow-hidden font-sans">
      
      {/* SECCI√ìN IZQUIERDA: IM√ÅGENES Y ARTE */}
      <div className="hidden md:flex w-1/2 bg-black relative flex-col items-center justify-center p-12 overflow-hidden">
         {/* Fondo Art√≠stico */}
         <div className="absolute inset-0 z-0">
             <img 
                src="18 sin t√≠tulo_20250624095942.jpg" 
                alt="Arte Redstripe" 
                className="w-full h-full object-cover opacity-60 mix-blend-luminosity hover:mix-blend-normal transition-all duration-1000"
                onError={(e) => { e.target.style.display='none'; e.target.parentElement.style.backgroundColor='#111'; }}
             />
             <div className="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"></div>
         </div>

         {/* Contenido sobre la imagen */}
         <div className="relative z-10 flex flex-col items-center text-center space-y-6 max-w-lg">
             <div className="w-64 mb-4">
                 <img 
                    src="logo.jpg" 
                    alt="REDSTRIPE LOGO" 
                    className="w-full h-auto drop-shadow-2xl" 
                 />
             </div>
             
             <h1 className="text-5xl text-white font-bebas tracking-wider leading-none">
                 M√ÅS QUE MODA,<br/>
                 <span className="text-[var(--primary-red)]">ES CULTURA.</span>
             </h1>
             <p className="text-gray-300 text-sm max-w-xs leading-relaxed">
                 √önete a la comunidad creativa m√°s grande. Descubre ropa exclusiva y assets digitales √∫nicos.
             </p>
         </div>
      </div>

      {/* SECCI√ìN DERECHA: FORMULARIO */}
      <div 
        className="w-full md:w-1/2 flex items-center justify-center p-8 lg:p-16 relative"
        style={{
            backgroundImage: 'url("https://images.unsplash.com/photo-1542253775-80252c1e67e3?q=80&w=2071")', // Textura madera quemada
            backgroundSize: 'cover',
            backgroundPosition: 'center',
        }}
      >
        {/* Overlay para oscurecer y difuminar el fondo de madera */}
        <div className="absolute inset-0 bg-white/90 backdrop-blur-sm z-0"></div>

        <div className="max-w-md w-full fade-in space-y-8 relative z-10">
            <div className="text-center md:text-left">
                <h2 className="text-3xl font-bold mb-2 font-bebas tracking-wide text-4xl">{isLogin ? "BIENVENIDO DE NUEVO" : "CREA TU CUENTA"}</h2>
                <p className="text-gray-500 text-sm">Ingresa tus datos para continuar</p>
            </div>

            <div className="space-y-5">
                {!isLogin && (
                    <div className="space-y-1">
                        <label className="text-xs font-bold text-gray-600 uppercase ml-1">Nombre Completo</label>
                        <input 
                            placeholder="Ej. Cris Herra" 
                            className="w-full bg-white/80 border border-gray-300 rounded-lg px-4 py-3 text-sm focus:ring-2 focus:ring-[var(--primary-red)] focus:border-transparent outline-none transition-all shadow-sm"
                            onChange={e => setFormData({...formData, name: e.target.value})} 
                        />
                    </div>
                )}
                
                <div className="space-y-1">
                    <label className="text-xs font-bold text-gray-600 uppercase ml-1">Correo Electr√≥nico</label>
                    <div className="relative">
                        <Mail className="absolute left-4 top-3.5 text-gray-500" size={18} />
                        <input 
                            placeholder="usuario@ejemplo.com" 
                            className="w-full bg-white/80 border border-gray-300 rounded-lg pl-12 pr-4 py-3 text-sm focus:ring-2 focus:ring-[var(--primary-red)] focus:border-transparent outline-none transition-all shadow-sm"
                            onChange={e => setFormData({...formData, email: e.target.value})} 
                        />
                    </div>
                </div>

                <div className="space-y-1">
                    <label className="text-xs font-bold text-gray-600 uppercase ml-1">Contrase√±a</label>
                    <div className="relative">
                        <Lock className="absolute left-4 top-3.5 text-gray-500" size={18} />
                        <input 
                            type="password" 
                            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
                            className="w-full bg-white/80 border border-gray-300 rounded-lg pl-12 pr-4 py-3 text-sm focus:ring-2 focus:ring-[var(--primary-red)] focus:border-transparent outline-none transition-all shadow-sm"
                            onChange={e => setFormData({...formData, password: e.target.value})} 
                        />
                    </div>
                </div>

                <button onClick={handleSubmit} className="w-full bg-black text-white py-4 rounded-lg font-bold text-sm hover:bg-[var(--primary-red)] transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                    {isLogin ? "INICIAR SESI√ìN" : "REGISTRARSE"}
                </button>

                <div className="relative flex py-2 items-center">
                    <div className="flex-grow border-t border-gray-300"></div>
                    <span className="flex-shrink-0 mx-4 text-gray-500 text-xs uppercase">O contin√∫a con</span>
                    <div className="flex-grow border-t border-gray-300"></div>
                </div>

                <button onClick={handleGuest} className="w-full bg-white/80 backdrop-blur text-black border-2 border-black py-3 rounded-lg font-bold text-sm hover:bg-white transition-colors flex justify-center items-center gap-2 shadow-sm">
                    <User size={18} />
                    ENTRAR COMO INVITADO
                </button>

                <div className="text-center mt-6">
                    <button onClick={() => setIsLogin(!isLogin)} className="text-sm font-medium hover:text-[var(--primary-red)] transition-colors underline decoration-dotted underline-offset-4">
                        {isLogin ? "¬øNo tienes cuenta? Reg√≠strate gratis" : "¬øYa tienes cuenta? Inicia sesi√≥n"}
                    </button>
                </div>
            </div>
        </div>
      </div>
    </div>
  );
};

const AdminLayout = ({ user, setUser }) => (
    <div className="flex h-screen bg-gray-100">
        <aside className="w-64 bg-white border-r border-gray-200 p-6">
            <h1 className="text-2xl font-bebas mb-8">ADMIN PANEL</h1>
            <nav className="space-y-2">
                <button className="w-full text-left px-4 py-2 bg-black text-white rounded text-sm font-bold">Dashboard</button>
                <button className="w-full text-left px-4 py-2 text-gray-500 hover:bg-gray-100 rounded text-sm font-bold">Productos</button>
                <button className="w-full text-left px-4 py-2 text-gray-500 hover:bg-gray-100 rounded text-sm font-bold">Comisiones</button>
            </nav>
            <button onClick={setUser} className="mt-auto absolute bottom-6 flex items-center gap-2 text-red-500 text-sm font-bold"><LogOut size={16}/> Salir</button>
        </aside>
        <main className="flex-1 p-8">
            <h2 className="text-3xl font-bebas mb-6">Dashboard General</h2>
            <div className="grid grid-cols-3 gap-6">
                <div className="bg-white p-6 rounded-lg shadow-sm">
                    <p className="text-gray-400 text-xs font-bold uppercase">Ventas Totales</p>
                    <p className="text-3xl font-bebas mt-2">$12,450.00</p>
                </div>
                <div className="bg-white p-6 rounded-lg shadow-sm">
                    <p className="text-gray-400 text-xs font-bold uppercase">Comisiones Activas</p>
                    <p className="text-3xl font-bebas mt-2">4</p>
                </div>
            </div>
        </main>
    </div>
);